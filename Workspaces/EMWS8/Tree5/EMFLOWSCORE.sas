****************************************************************;
******             DECISION TREE SCORING CODE             ******;
****************************************************************;

******         LENGTHS OF NEW CHARACTER VARIABLES         ******;
LENGTH F_DepVar  $   12;
LENGTH I_DepVar  $   12;
LENGTH _WARN_  $    4;

******              LABELS FOR NEW VARIABLES              ******;
LABEL _NODE_  = 'Node' ;
LABEL _LEAF_  = 'Leaf' ;
LABEL P_DepVar0  = 'Predicted: DepVar=0' ;
LABEL P_DepVar1  = 'Predicted: DepVar=1' ;
LABEL Q_DepVar0  = 'Unadjusted P: DepVar=0' ;
LABEL Q_DepVar1  = 'Unadjusted P: DepVar=1' ;
LABEL V_DepVar0  = 'Validated: DepVar=0' ;
LABEL V_DepVar1  = 'Validated: DepVar=1' ;
LABEL R_DepVar0  = 'Residual: DepVar=0' ;
LABEL R_DepVar1  = 'Residual: DepVar=1' ;
LABEL F_DepVar  = 'From: DepVar' ;
LABEL I_DepVar  = 'Into: DepVar' ;
LABEL U_DepVar  = 'Unnormalized Into: DepVar' ;
LABEL _WARN_  = 'Warnings' ;


******      TEMPORARY VARIABLES FOR FORMATTED VALUES      ******;
LENGTH _ARBFMT_12 $     12; DROP _ARBFMT_12;
_ARBFMT_12 = ' '; /* Initialize to avoid warning. */
LENGTH _ARBFMT_8 $      8; DROP _ARBFMT_8;
_ARBFMT_8 = ' '; /* Initialize to avoid warning. */


_ARBFMT_12 = PUT( DepVar , BEST.);
 %DMNORMCP( _ARBFMT_12, F_DepVar );

******             ASSIGN OBSERVATION TO NODE             ******;
IF  NOT MISSING(Recency ) AND
  Recency  <                 38.5 THEN DO;
  IF  NOT MISSING(MntMeatProducts ) AND
                   431.5 <= MntMeatProducts  THEN DO;
    IF  NOT MISSING(NumCatalogPurchases ) AND
      NumCatalogPurchases  <                  5.5 THEN DO;
      _ARBFMT_8 = PUT( Marital_Status , $8.);
       %DMNORMIP( _ARBFMT_8);
      IF _ARBFMT_8 IN ('MARRIED' ,'TOGETHER' ) THEN DO;
        _NODE_  =                   21;
        _LEAF_  =                    5;
        P_DepVar0  =     0.71052631578947;
        P_DepVar1  =     0.28947368421052;
        Q_DepVar0  =     0.71052631578947;
        Q_DepVar1  =     0.28947368421052;
        V_DepVar0  =     0.66666666666666;
        V_DepVar1  =     0.33333333333333;
        I_DepVar  = '0' ;
        U_DepVar  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   20;
        _LEAF_  =                    4;
        P_DepVar0  =     0.17647058823529;
        P_DepVar1  =      0.8235294117647;
        Q_DepVar0  =     0.17647058823529;
        Q_DepVar1  =      0.8235294117647;
        V_DepVar0  =                 0.25;
        V_DepVar1  =                 0.75;
        I_DepVar  = '1' ;
        U_DepVar  =                    1;
        END;
      END;
    ELSE DO;
      _NODE_  =                   11;
      _LEAF_  =                    6;
      P_DepVar0  =     0.15730337078651;
      P_DepVar1  =     0.84269662921348;
      Q_DepVar0  =     0.15730337078651;
      Q_DepVar1  =     0.84269662921348;
      V_DepVar0  =     0.29411764705882;
      V_DepVar1  =     0.70588235294117;
      I_DepVar  = '1' ;
      U_DepVar  =                    1;
      END;
    END;
  ELSE DO;
    _ARBFMT_12 = PUT( AcceptedCmp3 , BEST.);
     %DMNORMIP( _ARBFMT_12);
    IF _ARBFMT_12 IN ('1' ) THEN DO;
      IF  NOT MISSING(NumWebVisitsMonth ) AND
        NumWebVisitsMonth  <                  5.5 THEN DO;
        _NODE_  =                   16;
        _LEAF_  =                    1;
        P_DepVar0  =     0.64705882352941;
        P_DepVar1  =     0.35294117647058;
        Q_DepVar0  =     0.64705882352941;
        Q_DepVar1  =     0.35294117647058;
        V_DepVar0  =     0.57142857142857;
        V_DepVar1  =     0.42857142857142;
        I_DepVar  = '0' ;
        U_DepVar  =                    0;
        END;
      ELSE DO;
        _NODE_  =                   17;
        _LEAF_  =                    2;
        P_DepVar0  =     0.17391304347826;
        P_DepVar1  =     0.82608695652173;
        Q_DepVar0  =     0.17391304347826;
        Q_DepVar1  =     0.82608695652173;
        V_DepVar0  =                 0.15;
        V_DepVar1  =                 0.85;
        I_DepVar  = '1' ;
        U_DepVar  =                    1;
        END;
      END;
    ELSE DO;
      _NODE_  =                    9;
      _LEAF_  =                    3;
      P_DepVar0  =     0.82099596231493;
      P_DepVar1  =     0.17900403768506;
      Q_DepVar0  =     0.82099596231493;
      Q_DepVar1  =     0.17900403768506;
      V_DepVar0  =     0.80966767371601;
      V_DepVar1  =     0.19033232628398;
      I_DepVar  = '0' ;
      U_DepVar  =                    0;
      END;
    END;
  END;
ELSE DO;
  _ARBFMT_12 = PUT( AcceptedCmp5 , BEST.);
   %DMNORMIP( _ARBFMT_12);
  IF _ARBFMT_12 IN ('1' ) THEN DO;
    IF  NOT MISSING(MntWines ) AND
      MntWines  <                412.5 THEN DO;
      _NODE_  =                   12;
      _LEAF_  =                    7;
      P_DepVar0  =     0.13333333333333;
      P_DepVar1  =     0.86666666666666;
      Q_DepVar0  =     0.13333333333333;
      Q_DepVar1  =     0.86666666666666;
      V_DepVar0  =     0.16666666666666;
      V_DepVar1  =     0.83333333333333;
      I_DepVar  = '1' ;
      U_DepVar  =                    1;
      END;
    ELSE DO;
      _NODE_  =                   13;
      _LEAF_  =                    8;
      P_DepVar0  =     0.70833333333333;
      P_DepVar1  =     0.29166666666666;
      Q_DepVar0  =     0.70833333333333;
      Q_DepVar1  =     0.29166666666666;
      V_DepVar0  =     0.63461538461538;
      V_DepVar1  =     0.36538461538461;
      I_DepVar  = '0' ;
      U_DepVar  =                    0;
      END;
    END;
  ELSE DO;
    _NODE_  =                    7;
    _LEAF_  =                    9;
    P_DepVar0  =     0.96877380045696;
    P_DepVar1  =     0.03122619954303;
    Q_DepVar0  =     0.96877380045696;
    Q_DepVar1  =     0.03122619954303;
    V_DepVar0  =     0.96756756756756;
    V_DepVar1  =     0.03243243243243;
    I_DepVar  = '0' ;
    U_DepVar  =                    0;
    END;
  END;

*****  RESIDUALS R_ *************;
IF  F_DepVar  NE '0'
AND F_DepVar  NE '1'  THEN DO;
        R_DepVar0  = .;
        R_DepVar1  = .;
 END;
 ELSE DO;
       R_DepVar0  =  -P_DepVar0 ;
       R_DepVar1  =  -P_DepVar1 ;
       SELECT( F_DepVar  );
          WHEN( '0'  ) R_DepVar0  = R_DepVar0  +1;
          WHEN( '1'  ) R_DepVar1  = R_DepVar1  +1;
       END;
 END;

****************************************************************;
******          END OF DECISION TREE SCORING CODE         ******;
****************************************************************;
drop _LEAF_;
